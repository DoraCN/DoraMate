# 04画布与连线设计

## 1. 设计目标与核心原则

### 1.1 设计目标

- 用户在 **1 秒内** 能看清数据流向
- 在多节点、多连线场景下画布仍可被快速理解
- 尽量在“连接发生前”避免错误，而非事后提示
- 运行状态下，让“数据正在流动”具备直观感知

### 1.2 核心设计原则

- **结构优先于装饰**
- **视觉表达优先于文字说明**
- **强规则优于自由连接**
- **所有交互必须即时反馈**


---

## 2. 节点与端口基础规则

### 2.1 数据流方向规则（强制）

- 所有节点 **输入端口固定在左侧**
- 所有节点 **输出端口固定在右侧**
- 数据流方向统一为：**从左 → 到右**
- 禁止反向连接与环形连接（V1.0）

该规则用于从结构层面降低用户的理解成本，确保 Flow 在视觉上具备一致的阅读方向。

---

### 2.2 端口级连接规则

- 连线必须从 **端口 → 端口**
- 禁止节点整体作为连接目标
- 每条连线只允许绑定一个输入端口

#### 端口基础样式

- 形状：圆形  
- 直径：10px  
- 默认颜色：#9CA3AF  

---

### 2.3 端口交互反馈

- 鼠标悬停端口时：
  - 端口高亮
  - 可连接端口显示强调样式
- 当端口类型不合法时：
  - 禁止建立连接
  - 不进入“连线预览”状态

端口是否可连必须在拖拽开始阶段就给出明确反馈，而非在松手后报错。

---

## 3. 连线设计规范

### 3.1 连线基础样式

- 线型：贝塞尔曲线
- 线宽：2px
- 默认颜色：#6B7280
- 不显示箭头  
  数据方向通过端口固定位置（左输入 / 右输出）进行隐式表达

该设计用于减少画面噪音，避免在多连线场景下出现方向箭头堆叠的问题。

---

### 3.2 连线创建流程

连线创建遵循严格的交互流程：

1. 用户从 **输出端口** 按下并开始拖拽
2. 鼠标移动过程中显示实时连线预览
3. 当鼠标进入合法输入端口范围时：
   - 输入端口高亮
   - 连线样式发生变化（颜色或状态）
4. 松开鼠标，完成连线创建

任何不符合规则的操作，均不进入“可完成连接”状态。

---

### 3.3 连线预览状态

在拖拽过程中，连线进入预览态：

- 样式：
  - 虚线
  - 颜色：#3B82F6
- 仅当目标端口合法时，预览连线保持蓝色

若目标端口不合法：

- 连线立即变为红色（#EF4444）
- 松开鼠标不创建连线

预览阶段即给出明确反馈，避免“先连上再报错”。

---

### 3.4 非法连接处理规则

非法连接包括但不限于以下情况：

- 输入端口 → 输入端口
- 输出端口 → 输出端口
- 节点自连接
- 数据类型不匹配

反馈策略：

- 仅使用即时视觉反馈（红色）
- 不弹窗、不显示文字提示
- 鼠标移出非法区域后，状态立即恢复

V1.0 阶段不对非法操作进行解释性提示，以保持交互的流畅性。

---

### 3.5 多条连线的分叉与偏移

当一个输出端口连接多个下游节点时：

- 连线起点在端口处进行轻微偏移
- 多条曲线在中段自然展开
- 避免多条连线完全重叠

目标效果为“线束分叉”，而非多条线叠加在同一路径上。

该规则仅作用于视觉层，不改变真实连接关系。

---

### 3.6 选中与聚焦状态

当用户选中某个节点时：

- 与该节点直接相关的上下游连线高亮显示
- 所有无关连线透明度降低至 0.2

设计目的：

- 帮助用户快速理解当前节点在 Flow 中的位置
- 在复杂画布中提供局部聚焦能力，降低认知负担

取消选中后，所有连线状态恢复默认。

---



## 4. 运行状态下的连线反馈

当用户点击「本地运行」后：

- 所有参与执行路径的连线变为绿色
- 颜色：#22C55E
- 连线上显示缓慢流动的小圆点动画

动画仅用于表达“数据正在流动”，避免高频或强干扰效果。

运行期间：

- 禁止新增或删除连线
- 禁止节点结构性移动

---

## 5. 画布交互与布局规范

### 5.1 网格与自动对齐

- 画布使用隐形网格系统
- 节点拖动时自动吸附对齐
- 同一流程链路的节点应自然呈现横向排列

该设计用于：
- 减少连线交叉
- 提升整体整洁度与专业感

---

### 5.2 节点拖拽反馈

- 拖拽中的节点透明度降低至 0.7
- 松开后恢复为 1.0
- 拖拽过程中实时更新连线位置
- 使用隐形网格进行轻量吸附对齐
---

## 6. 复杂流程的扩展设计（非 V1.0 强制实现）


以下能力在设计上预留，但不强制进入 V1.0 实现：

- 子流程 / 折叠节点
- 自动布局
- 环形结构可视化
- 连线手动弯折控制

---

## 7. 设计总结

- 连线是信息表达载体，而非装饰元素
- 默认状态弱化，交互与运行状态强化
- 所有错误应在产生瞬间被阻止
- 所有视觉变化必须具备明确语义


---

## 8. 使用说明

本规范用于指导：

- Canvas 与 Edge 的交互逻辑实现
- 连线样式与动画效果开发
- 前端与可视化引擎行为对齐

需与本仓库中的其他 UI/UX 设计文档配合使用。

