# 06 运行与系统反馈

## 1. 运行控制模型

DoraMate V1.0 采用 **单 Flow、单实例** 的运行模型：

- 同一时间只允许一个 Flow 处于运行状态
- Run / Stop 为全局控制，不区分局部节点
- 不支持并行运行多个 Flow（V1.0）

该模型用于降低系统复杂度，并确保运行状态在 UI 层面可被清晰表达。

---

## 2. 运行前反馈

### 2.1 结构校验要求

用户点击「Run」前，系统必须完成基础结构校验，包括但不限于：

- 是否存在未连接的必要端口
- 是否存在非法连接关系
- 是否存在无法执行的节点结构

在校验未通过前：

- 不允许进入运行状态
- Run 操作直接被拦截

---

### 2.2 校验失败的反馈方式

当校验失败时，系统应提供以下反馈：

- 在画布中高亮显示问题节点或连线
- 将画布视角自动定位到问题区域
- Run 按钮保持不可用状态

V1.0 阶段不要求展示完整错误描述文本，
但必须保证用户能够 **通过画布定位问题位置**。

---

## 3. 运行中反馈

### 3.1 全局运行状态提示

进入运行状态后：

- Run 按钮切换为 Stop
- 工具栏显示当前为运行态
- 所有结构性编辑操作被禁用

用户应在无需额外操作的情况下，明确感知系统正在运行。

---

### 3.2 画布内运行反馈

运行中的主要反馈应发生在画布内：

- 参与执行的数据流连线高亮显示
- 连线上出现表示数据流动的动画
- 正在执行路径在视觉上形成连续流向

非执行路径应弱化显示，避免干扰当前关注区域。

---

### 3.3 运行期间的交互限制

在运行状态下：

- 禁止新增或删除节点
- 禁止修改连线结构
- 禁止拖拽节点位置

允许的操作仅包括：

- 画布平移与缩放
- 查看节点与属性信息
- 主动点击 Stop 停止运行

---

## 4. 停止与运行结束反馈

### 4.1 主动停止

用户点击 Stop 后：

- 所有运行态动画立即终止
- 连线与节点状态恢复为默认
- 系统返回可编辑状态

停止操作应具备即时响应，不引入延迟反馈。

---

### 4.2 运行自然结束

当 Flow 正常执行完成时：

- 运行态反馈自然结束
- 系统自动退出运行状态
- 不弹出完成提示或干扰性反馈

完成状态通过“运行反馈消失”进行隐式表达。

---

## 5. 异常运行反馈（V1.0 基础支持）

当运行过程中发生异常（如节点执行失败）：

- 对应节点进入 Error 状态
- 与该节点相关的连线高亮为错误态
- 系统自动停止运行

V1.0 阶段不强制提供完整错误链路分析，
但必须保证错误节点在画布中可被快速定位。

---

## 6. 设计约束说明

- 运行反馈以画布内视觉变化为主
- 避免使用弹窗、Toast 等打断式反馈
- 所有运行状态变化必须可逆、可恢复
- 不为未来功能预埋复杂运行态表现

---

## 7. 设计目标总结

- 用户始终知道系统当前是否可运行
- 运行中状态一眼可见、无需解释
- 停止与结束行为明确、可预期
- 系统反馈不过度干扰主要操作流程
