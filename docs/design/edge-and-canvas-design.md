# DoraMate 可视化节点连线与画布设计规范（V1.0）

本文档定义 DoraMate V1.0 中可视化节点编辑器的连线（Edge）与画布（Canvas）设计规范，
目标是在节点数量增加的情况下，仍然保持 **高可读性、低误操作率和流畅的用户体验**。

---

## 1. 设计目标与核心原则

### 1.1 核心目标

- 用户在 **1 秒内** 能看清数据流向
- 在多节点、多连线场景下保持画布整洁
- 降低错误连接的发生概率
- 运行状态下让“数据正在流动”具备直观感知

### 1.2 核心设计原则

- 可视化优先于文本
- 默认简单，高级能力逐步显现
- 强制规则优于事后纠错
- 所有状态变化必须即时反馈

---

## 2. 节点与端口基础规则

### 2.1 数据流方向规则（强制）

- 所有节点 **输入端口固定在左侧**
- 所有节点 **输出端口固定在右侧**
- 数据流方向统一为：**从左 → 到右**
- 不允许任意方向连接

此规则用于从根本上解决方向混乱与认知负担问题。

---

### 2.2 端口级连接（禁止节点整体连接）

- 连线必须从 **端口 → 端口**
- 禁止节点整体拖拽连接
- 端口样式：
  - 圆形
  - 直径：10px
  - 默认颜色：#9CA3AF

#### 端口交互反馈

- 鼠标悬停在端口上时高亮
- 仅当端口类型合法时才允许连接
- 不合法端口不响应连接操作

---

## 3. 连线（Edge）视觉设计规范

### 3.1 默认状态

- 颜色：#6B7280
- 线宽：2px
- 曲线类型：贝塞尔曲线
- 透明度：0.6

默认状态下连线应弱化存在感，避免画面噪音。

---

### 3.2 多条连线的分叉与偏移（Edge Offset）

当一个输出端口连接多个下游节点时：

- 连线起点进行轻微偏移
- 曲线在中段自然展开
- 避免多条线完全重叠

设计目标是让多条连线呈现“线束分叉”的视觉效果，而非杂乱交叉。

---

### 3.3 选中与聚焦状态

当用户选中某个节点时：

- 该节点相关的上下游连线高亮显示
- 其他所有无关连线透明度降低至 0.2

目的：
- 帮助用户快速理解当前节点所处的数据流位置
- 避免信息过载

---

## 4. 连线状态反馈设计

### 4.1 合法连接预览

在拖拽连线过程中：

- 合法连接显示为蓝色虚线
- 颜色：#3B82F6
- 鼠标释放后转为默认状态

---

### 4.2 非法连接（错误态）

非法连接条件示例：
- 输入 / 输出类型不匹配
- 端口已被占用
- 不允许的节点类型连接

错误反馈规则：

- 连线立即变为红色（#EF4444）
- 鼠标释放后自动断开
- 不允许错误连线残留在画布上

错误反馈必须：
- 即时
- 强烈
- 可逆

---

### 4.3 运行状态（数据流动）

当用户点击「本地运行」后：

- 所有参与执行路径的连线变为绿色
- 颜色：#22C55E
- 连线上显示缓慢流动的小圆点动画

动画语义：
- 表示数据正在该路径中流动
- 避免闪烁或高频动画

---

## 5. 画布（Canvas）层级与布局规范

### 5.1 网格与自动对齐

- 画布使用隐形网格系统
- 节点拖动时自动吸附对齐
- 同一流程链路的节点应自然呈现横向排列

该设计用于：
- 减少连线交叉
- 提升整体整洁度与专业感

---

### 5.2 节点拖拽反馈

- 拖拽中的节点透明度降低至 0.7
- 松开后恢复为 1.0
- 拖拽过程中实时更新连线位置

---

## 6. 复杂流程的扩展设计（非 V1.0 强制实现）

### 6.1 子流程 / 折叠节点（V1.1 预留）

当节点数量过多时，可支持：

- 多节点框选
- 右键 → 折叠为子流程
- 折叠后仅暴露输入 / 输出端口

该设计用于从结构层面解决连线爆炸问题。

---

## 7. UX 设计总结

- 连线不是装饰，而是信息表达载体
- 默认状态弱化，交互状态强化
- 任何错误必须在产生的瞬间被阻止
- 所有视觉变化都必须有明确语义

---

## 8. 实现说明（给前端 / AI）

本规范用于指导：

- Canvas 连线算法实现
- CSS / 动画样式生成
- 用户交互逻辑设计

可结合本仓库中的 UI 设计规范文档与组件代码共同使用。
