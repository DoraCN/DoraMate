# 07 - æ–‡ä»¶ç³»ç»Ÿæ¶æ„è®¾è®¡

> **æ ¸å¿ƒå†…å®¹**: çº¯æ–‡ä»¶ç³»ç»Ÿæ¶æ„ã€é›¶æ•°æ®åº“è®¾è®¡ã€æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ã€ä¸´æ—¶æ–‡ä»¶ç®¡ç†
>
> **â­ v4.0 æ›´æ–°è¯´æ˜**: æœ¬æ–‡æ¡£æè¿° DoraMate çš„æ–‡ä»¶ç³»ç»Ÿæ¶æ„ï¼Œé‡‡ç”¨ **çº¯æ–‡ä»¶ç³»ç»Ÿè®¾è®¡**ï¼Œå®Œå…¨é¿å…æ•°æ®åº“ä¾èµ–ã€‚å‰ç«¯ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿèƒ½åŠ›ï¼Œåç«¯ä½¿ç”¨æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿ APIï¼Œå®ç°é›¶é…ç½®ã€é›¶ä¾èµ–çš„æ•°æ®ç®¡ç†ã€‚
>
> **âš ï¸ å½“å‰å®ç°çŠ¶æ€**: å‰ç«¯å·²å®Œæˆ âœ… | åç«¯ MVP (ä¸´æ—¶æ–‡ä»¶) âœ… | é«˜çº§åŠŸèƒ½ ğŸš§

---

## ğŸ¯ 7.0 è®¾è®¡ç›®æ ‡ä¸åŸåˆ™

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

**Unix å“²å­¦**: "ä¸€åˆ‡çš†æ–‡ä»¶"

DoraMate é‡‡ç”¨çº¯æ–‡ä»¶ç³»ç»Ÿæ¶æ„ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **é›¶æ•°æ®åº“** - ä¸ä½¿ç”¨ä»»ä½•æ•°æ®åº“ç³»ç»Ÿï¼ˆSQLiteã€PostgreSQL ç­‰ï¼‰
2. **é›¶é…ç½®** - æ— éœ€æ•°æ®åº“åˆå§‹åŒ–ã€è¿ç§»ã€è¿æ¥é…ç½®
3. **é›¶ä¾èµ–** - åªä¾èµ–æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿ API
4. **å¯ç§»æ¤æ€§** - æ•°æ®æµæ–‡ä»¶å³é¡¹ç›®ï¼Œæ˜“äºå¤‡ä»½å’Œåˆ†äº«
5. **é€æ˜æ€§** - æ‰€æœ‰æ•°æ®ä»¥äººç±»å¯è¯»çš„ YAML æ ¼å¼å­˜å‚¨

### ä¸ºä»€ä¹ˆé€‰æ‹©çº¯æ–‡ä»¶ç³»ç»Ÿï¼Ÿ

**ä¼ ç»Ÿæ–¹å¼ vs æ–‡ä»¶ç³»ç»Ÿæ–¹å¼**:

| ç»´åº¦ | ä¼ ç»Ÿæ•°æ®åº“æ–¹å¼ | çº¯æ–‡ä»¶ç³»ç»Ÿæ–¹å¼ | ä¼˜åŠ¿ |
|-----|--------------|--------------|------|
| **é…ç½®å¤æ‚åº¦** | â­â­â­â­â­ (éœ€é…ç½® DB) | â­ (é›¶é…ç½®) | **100% ç®€åŒ–** |
| **å¯åŠ¨é€Ÿåº¦** | â­â­â­ (è¿æ¥ DB) | â­â­â­â­â­ (å³å¼€å³ç”¨) | **10x æå‡** |
| **å¤‡ä»½æ¢å¤** | â­â­â­ (éœ€å¯¼å‡º) | â­â­â­â­â­ (å¤åˆ¶æ–‡ä»¶) | **10x ç®€åŒ–** |
| **ç‰ˆæœ¬æ§åˆ¶** | â­â­â­ (äºŒè¿›åˆ¶) | â­â­â­â­â­ (æ–‡æœ¬å‹å¥½) | **Git é›†æˆ** |
| **è°ƒè¯•éš¾åº¦** | â­â­â­ (éœ€ SQL æŸ¥è¯¢) | â­â­â­â­â­ (ç›´æ¥æŸ¥çœ‹) | **10x ç®€åŒ–** |
| **è·¨å¹³å°** | â­â­â­â­ (éœ€é€‚é…) | â­â­â­â­â­ (åŸç”Ÿ API) | **å®Œå…¨å…¼å®¹** |
| **å¹¶å‘æ€§èƒ½** | â­â­â­â­â­ (ACID) | â­â­â­â­ (æ–‡ä»¶é”) | DB èƒœå‡º |

**é€‰æ‹©çº¯æ–‡ä»¶ç³»ç»Ÿçš„ç†ç”±**:
- âœ… **ç®€åŒ–å¼€å‘** - æ— éœ€ ORMã€æ•°æ®åº“é©±åŠ¨ã€è¿ç§»å·¥å…·
- âœ… **é™ä½é—¨æ§›** - ç”¨æˆ·æ— éœ€äº†è§£æ•°æ®åº“
- âœ… **æ˜“äºåˆ†äº«** - YAML æ–‡ä»¶å¯ç›´æ¥é€šè¿‡ Git/é‚®ä»¶/ç½‘ç›˜åˆ†äº«
- âœ… **é€æ˜è°ƒè¯•** - å¯ç›´æ¥æ‰“å¼€æ–‡ä»¶æŸ¥çœ‹å’Œç¼–è¾‘
- âœ… **å·¥ä¸šåœºæ™¯** - å·¥ä¸šè½¯ä»¶å¸¸ç”¨é…ç½®æ–‡ä»¶è€Œéæ•°æ®åº“

**é€‚ç”¨åœºæ™¯**:
- âœ… æ•°æ®æµé…ç½®ç®¡ç†
- âœ… ç”¨æˆ·åå¥½è®¾ç½®
- âœ… æœ€è¿‘æ–‡ä»¶åˆ—è¡¨
- âœ… ä¸´æ—¶è¿è¡Œæ•°æ®
- âŒ é«˜å¹¶å‘äº‹åŠ¡å¤„ç†ï¼ˆæ­¤æ—¶åº”ä½¿ç”¨æ•°æ®åº“ï¼‰

---

## ğŸ—ï¸ 7.1 æ¶æ„æ€»è§ˆ

### æ–‡ä»¶ç³»ç»Ÿæ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯ (Leptos WebAssembly)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ æµè§ˆå™¨æ–‡ä»¶ API                                    â”‚
â”‚  â”œâ”€â”€ File API (æ–‡ä»¶åŠ è½½)                             â”‚
â”‚  â”œâ”€â”€ Blob API (æ–‡ä»¶ä¿å­˜)                             â”‚
â”‚  â””â”€â”€ LocalStorage (æœ€è¿‘æ–‡ä»¶)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†• HTTP (YAML string)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åç«¯ (Axum + Tokio)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ æ–‡ä»¶ç³»ç»Ÿ API                                      â”‚
â”‚  â”œâ”€â”€ std::fs (åŒæ­¥æ–‡ä»¶æ“ä½œ)                          â”‚
â”‚  â”œâ”€â”€ tokio::fs (å¼‚æ­¥æ–‡ä»¶æ“ä½œ) ğŸš§                     â”‚
â”‚  â””â”€â”€ std::env::temp_dir() (ä¸´æ—¶ç›®å½•)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†• æ–‡ä»¶ I/O
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Windows: C:\Users\<user>\AppData\Local\Temp\        â”‚
â”‚  Linux:   /tmp/                                      â”‚
â”‚  macOS:   /tmp/                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå›¾

**æ–‡ä»¶æ“ä½œæµç¨‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ è½½ YAML    â”‚
â”‚ (æµè§ˆå™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ FileReader API
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§£æ YAML    â”‚
â”‚ (serde_yaml) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Dataflow ç»“æ„
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯ç¼–è¾‘     â”‚
â”‚ (æ‹–æ‹½è¿çº¿)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ä¿®æ”¹
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åºåˆ—åŒ– YAML  â”‚
â”‚ (DORA æ ¼å¼)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Blob API
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹è½½æ–‡ä»¶     â”‚
â”‚ (æµè§ˆå™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ è¿è¡ŒæŒ‰é’®
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP POST    â”‚
â”‚ /api/run     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ YAML string
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†™å…¥ä¸´æ—¶æ–‡ä»¶ â”‚
â”‚ (std::fs)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dora start   â”‚
â”‚ (ä¸´æ—¶æ–‡ä»¶)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» 7.2 å‰ç«¯æ–‡ä»¶ç³»ç»Ÿå®ç°

### 7.2.1 æ–‡ä»¶åŠ è½½ (YAML Import)

**ç»„ä»¶**: `src/components/file_loader.rs:28-53`

**æ ¸å¿ƒä»£ç è§£æ**:

```rust
// æ–‡ä»¶åŠ è½½äº‹ä»¶å¤„ç†å™¨
let on_file_change = {
    let set_dataflow = set_dataflow.clone();
    move |e: Event| {
        // 1. è·å–æ–‡ä»¶è¾“å…¥
        let input = e.target().unwrap()
            .unchecked_into::<web_sys::HtmlInputElement>();

        if let Some(files) = input.files() {
            if let Some(file) = files.get(0) {
                let file_name = file.name();
                let set_dataflow = set_dataflow.clone();

                // 2. å¼‚æ­¥è¯»å–æ–‡ä»¶
                wasm_bindgen_futures::spawn_local(async move {
                    match read_yaml_file(file).await {
                        Ok(df) => {
                            // 3. æ›´æ–°æ•°æ®æµçŠ¶æ€
                            set_dataflow(df);

                            // 4. æ·»åŠ åˆ°æœ€è¿‘æ–‡ä»¶
                            add_recent_file(
                                file_name.clone(),
                                file_name.clone()
                            );

                            log::info!("âœ… File loaded successfully!");
                        }
                        Err(e) => {
                            log::error!("âŒ Failed to load file: {}", e);
                        }
                    }
                });
            }
        }
    }
};
```

**æ–‡ä»¶è¯»å–å®ç°** (`src/utils/file.rs:9-50`):

```rust
pub async fn read_yaml_file(file: File) -> Result<Dataflow, String> {
    // 1. åˆ›å»º FileReader
    let reader = FileReader::new()
        .map_err(|e| format!("Failed to create FileReader: {:?}", e))?;

    // 2. åˆ›å»º Promise ç­‰å¾…è¯»å–å®Œæˆ
    let promise = js_sys::Promise::new(&mut |resolve, _reject| {
        let reader_clone = reader.clone();

        let onload = Closure::once_into_js(move |_: JsValue| {
            let result = reader_clone.result().unwrap();
            let text = result.as_string().unwrap();
            resolve.call1(&JsValue::NULL, &JsValue::from_str(&text)).unwrap();
        });

        reader.set_onload(Some(onload.as_ref().unchecked_ref()));
        reader.read_as_text(&file).unwrap();
    });

    // 3. ç­‰å¾… Promise å®Œæˆ
    let text = JsFuture::from(promise)
        .await
        .map_err(|e| format!("Failed to read file: {:?}", e))?
        .as_string()
        .ok_or("Failed to convert to string")?;

    // 4. å°è¯•è§£æä¸º DORA æ ¼å¼
    if let Ok(dora_dataflow) = serde_yaml::from_str::<DoraDataflow>(&text) {
        let dataflow: Dataflow = (&dora_dataflow).into();
        log::info!("âœ… Loaded DORA format dataflow");
        return Ok(dataflow);
    }

    // 5. å°è¯•è§£æä¸º DoraMate æ ¼å¼
    if let Ok(dataflow) = serde_yaml::from_str::<Dataflow>(&text) {
        log::info!("âœ… Loaded DoraMate format dataflow");
        return Ok(dataflow);
    }

    Err("Failed to parse YAML: Unknown format".to_string())
}
```

**æŠ€æœ¯äº®ç‚¹**:
- âœ… **åŒæ ¼å¼æ”¯æŒ** - è‡ªåŠ¨è¯†åˆ« DORA å’Œ DoraMate æ ¼å¼
- âœ… **å¼‚æ­¥è¯»å–** - ä½¿ç”¨ Promise + wasm-bindgen-futures
- âœ… **ç±»å‹å®‰å…¨** - serde_yaml ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- âœ… **é”™è¯¯å¤„ç†** - è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 7.2.2 æ–‡ä»¶ä¿å­˜ (YAML Export)

**ç»„ä»¶**: `src/components/file_loader.rs:56-61`

**æ ¸å¿ƒä»£ç è§£æ**:

```rust
// ä¿å­˜æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨
let on_save = move |_| {
    let df = dataflow.get();

    // 1. ä¿å­˜ä¸º YAML æ–‡ä»¶ï¼ˆè‡ªåŠ¨ä¸‹è½½ï¼‰
    save_yaml_file(&df, "dataflow.yaml");

    // 2. æ·»åŠ åˆ°æœ€è¿‘æ–‡ä»¶
    add_recent_file("dataflow.yaml".to_string(), "dataflow.yaml".to_string());

    log::info!("âœ… File saved successfully!");
};
```

**æ–‡ä»¶ä¿å­˜å®ç°** (`src/utils/file.rs:53-87`):

```rust
pub fn save_yaml_file(dataflow: &Dataflow, filename: &str) {
    // 1. è½¬æ¢ä¸º DORA æ ¼å¼ï¼ˆå…¼å®¹ dora-runtimeï¼‰
    let dora_dataflow: DoraDataflow = dataflow.into();

    // 2. åºåˆ—åŒ–ä¸º YAML
    let yaml = serde_yaml::to_string(&dora_dataflow)
        .unwrap_or_else(|_| "Error: Failed to serialize".to_string());

    log::info!("ğŸ“„ Saving YAML:\n{}", yaml);

    // 3. åˆ›å»º Blob
    let array = js_sys::Array::new();
    array.push(&JsValue::from_str(&yaml));

    let blob_options = BlobPropertyBag::new();
    blob_options.set_type("text/yaml");

    let blob = Blob::new_with_str_sequence_and_options(
        &array,
        &blob_options
    ).unwrap();

    // 4. åˆ›å»ºä¸‹è½½é“¾æ¥
    let url = Url::create_object_url_with_blob(&blob).unwrap();

    // 5. åˆ›å»ºä¸´æ—¶ <a> å…ƒç´ å¹¶è§¦å‘ç‚¹å‡»
    let window = web_sys::window().unwrap();
    let document = window.document().unwrap();
    let a = document.create_element("a").unwrap();
    let anchor = a.dyn_ref::<web_sys::HtmlAnchorElement>().unwrap();

    anchor.set_href(&url);
    anchor.set_download(filename);
    anchor.click();

    // 6. æ¸…ç† URL å¯¹è±¡
    web_sys::Url::revoke_object_url(&url).unwrap();
}
```

**æŠ€æœ¯äº®ç‚¹**:
- âœ… **DORA å…¼å®¹** - è‡ªåŠ¨è½¬æ¢ä¸º DORA æ ‡å‡†æ ¼å¼
- âœ… **æµè§ˆå™¨ä¸‹è½½** - ä½¿ç”¨ Blob + URL API
- âœ… **è‡ªåŠ¨æ¸…ç†** - revoke_object_url é˜²æ­¢å†…å­˜æ³„æ¼
- âœ… **ç”¨æˆ·å‹å¥½** - è‡ªåŠ¨è§¦å‘ä¸‹è½½ï¼Œæ— éœ€é¢å¤–æ“ä½œ

### 7.2.3 æœ€è¿‘æ–‡ä»¶ç®¡ç†

**å®ç°**: `src/utils/recent_files.rs`

**æ•°æ®ç»“æ„**:

```rust
/// æœ€è¿‘æ–‡ä»¶æ¡ç›®
#[derive(Clone, Serialize, Deserialize, Debug)]
pub struct RecentFileEntry {
    pub name: String,           // æ–‡ä»¶å
    pub path: String,           // æ–‡ä»¶è·¯å¾„
    pub last_modified: i64,     // Unix æ—¶é—´æˆ³
}

/// é…ç½®å¸¸é‡
const MAX_RECENT_FILES: usize = 10;  // æœ€å¤šä¿å­˜ 10 ä¸ª
const RECENT_FILES_KEY: &str = "doramate_recent_files";
```

**æ·»åŠ æœ€è¿‘æ–‡ä»¶**:

```rust
pub fn add_recent_file(name: String, path: String) {
    // 1. è·å–ç°æœ‰åˆ—è¡¨
    let mut recent_files = get_recent_files();
    let timestamp = js_sys::Date::now() as i64;

    // 2. ç§»é™¤æ—§æ¡ç›®ï¼ˆé¿å…é‡å¤ï¼‰
    recent_files.retain(|entry| entry.path != path);

    // 3. æ·»åŠ æ–°æ¡ç›®åˆ°å¼€å¤´
    recent_files.insert(
        0,
        RecentFileEntry {
            name,
            path,
            last_modified: timestamp,
        },
    );

    // 4. é™åˆ¶æ•°é‡
    recent_files.truncate(MAX_RECENT_FILES);

    // 5. ä¿å­˜åˆ° LocalStorage
    LocalStorage::set(RECENT_FILES_KEY, recent_files);
}
```

**è·å–æœ€è¿‘æ–‡ä»¶**:

```rust
pub fn get_recent_files() -> Vec<RecentFileEntry> {
    LocalStorage::get(RECENT_FILES_KEY).unwrap_or_default()
}
```

**æ—¶é—´æ ¼å¼åŒ–**:

```rust
pub fn format_timestamp(timestamp: i64) -> String {
    let date = js_sys::Date::new(&timestamp.into());
    let now_ms = js_sys::Date::now();
    let now = js_sys::Date::new(&now_ms.into());
    let diff_ms = now.get_time() - date.get_time();
    let diff_hours = diff_ms / (1000.0 * 60.0 * 60.0);
    let diff_days = diff_hours / 24.0;

    // æ™ºèƒ½æ ¼å¼åŒ–
    if diff_days < 1.0 {
        if diff_hours < 1.0 {
            "åˆšåˆš".to_string()
        } else {
            format!("{}å°æ—¶å‰", diff_hours.floor())
        }
    } else if diff_days < 7.0 {
        format!("{}å¤©å‰", diff_days.floor())
    } else {
        // æ ¼å¼åŒ–ä¸ºæ—¥æœŸ
        let year = date.get_full_year();
        let month = date.get_month() + 1; // 0-indexed
        let day = date.get_date();
        format!("{}-{:02}-{:02}", year, month, day)
    }
}
```

**UI å±•ç¤º**:

```rust
// æœ€è¿‘æ–‡ä»¶ä¸‹æ‹‰èœå•
<div class="recent-files-dropdown">
    <button
        on:click=move |_| set_show_recent.update(|s| *s = !*s)
        class="dropdown-button"
    >
        "ğŸ“‹ æœ€è¿‘"
    </button>

    <Show when=move || show_recent.get()>
        <div class="dropdown-menu">
            <div class="dropdown-header">"æœ€è¿‘æ–‡ä»¶"</div>

            <div class="dropdown-content">
                {recent_files.clone().into_iter().map(|entry| {
                    view! {
                        <div class="dropdown-item">
                            <div class="file-name">
                                {entry.name.clone()}
                            </div>
                            <div class="file-time">
                                {format_timestamp(entry.last_modified)}
                            </div>
                        </div>
                    }
                }).collect::<Vec<_>>()}
            </div>
        </div>
    </Show>
</div>
```

**æŠ€æœ¯äº®ç‚¹**:
- âœ… **LocalStorage** - æµè§ˆå™¨æŒä¹…åŒ–å­˜å‚¨
- âœ… **æ™ºèƒ½æ’åº** - æœ€æ–°æ–‡ä»¶åœ¨å‰
- âœ… **å»é‡æœºåˆ¶** - åŒä¸€æ–‡ä»¶åªä¿ç•™æœ€æ–°è®°å½•
- âœ… **å®¹é‡é™åˆ¶** - æœ€å¤š 10 ä¸ªæ–‡ä»¶
- âœ… **äººæ€§åŒ–æ—¶é—´** - "åˆšåˆš"ã€"2å°æ—¶å‰"ã€"2025-01-29"

---

## ğŸ–¥ï¸ 7.3 åç«¯æ–‡ä»¶ç³»ç»Ÿå®ç°

### 7.3.1 ä¸´æ—¶æ–‡ä»¶ç®¡ç† (MVP)

**å®ç°**: `doramate-localagent/src/main.rs:259-272`

**æ ¸å¿ƒä»£ç è§£æ**:

```rust
// 1. ç”Ÿæˆå”¯ä¸€è¿›ç¨‹ ID
let process_id = Uuid::new_v4().to_string();

// 2. è·å–ç³»ç»Ÿä¸´æ—¶ç›®å½•
let temp_dir = std::env::temp_dir();

// 3. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
let yaml_path = temp_dir.join(
    format!("doramate_{}.yml", process_id)
);
let yaml_path_str = yaml_path.to_string_lossy().to_string();

info!("ğŸ’¾ Saving YAML to: {}", yaml_path_str);

// 4. å†™å…¥ YAML æ–‡ä»¶
if let Err(e) = std::fs::write(&yaml_path, &req.dataflow_yaml) {
    error!("âŒ Failed to write YAML: {}", e);
    return Json(RunDataflowResponse {
        success: false,
        message: format!("Failed to write YAML: {}", e),
        process_id: None,
    });
}

// 5. å¯åŠ¨ DORA è¿›ç¨‹ï¼ˆä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼‰
let mut cmd = tokio::process::Command::new("dora");
cmd.arg("start")
    .arg(&yaml_path_str)  // ä¼ é€’ä¸´æ—¶æ–‡ä»¶è·¯å¾„
    .stdout(Stdio::piped())
    .stderr(Stdio::piped())
    .kill_on_drop(true);
```

**ä¸´æ—¶æ–‡ä»¶è·¯å¾„ç¤ºä¾‹**:

| æ“ä½œç³»ç»Ÿ | ä¸´æ—¶ç›®å½•è·¯å¾„ | ç¤ºä¾‹æ–‡ä»¶è·¯å¾„ |
|---------|------------|-------------|
| **Windows** | `C:\Users\<user>\AppData\Local\Temp\` | `C:\Users\Admin\AppData\Local\Temp\doramate_550e8400-e29b-41d4-a716-446655440000.yml` |
| **Linux** | `/tmp/` | `/tmp/doramate_550e8400-e29b-41d4-a716-446655440000.yml` |
| **macOS** | `/tmp/` | `/tmp/doramate_550e8400-e29b-41d4-a716-446655440000.yml` |

**æŠ€æœ¯äº®ç‚¹**:
- âœ… **è·¨å¹³å°** - ä½¿ç”¨ `std::env::temp_dir()` è‡ªåŠ¨é€‚é…
- âœ… **å”¯ä¸€æ€§** - UUID ç¡®ä¿æ–‡ä»¶åä¸å†²çª
- âœ… **ç®€æ´æ€§** - ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†ï¼Œæ— éœ€æ‰‹åŠ¨åˆ é™¤
- âœ… **å¯é æ€§** - åŒæ­¥å†™å…¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§

### 7.3.2 æ–‡ä»¶æ“ä½œ API å¯¹æ¯”

| æ“ä½œ | å‰ç«¯ (WASM) | åç«¯ (Axum) | è¯´æ˜ |
|-----|------------|------------|------|
| **è¯»å–** | `FileReader` API | `std::fs::read` / `tokio::fs::read` | å‰ç«¯å¼‚æ­¥ï¼Œåç«¯å¯é€‰åŒæ­¥/å¼‚æ­¥ |
| **å†™å…¥** | `Blob` + ä¸‹è½½ | `std::fs::write` / `tokio::fs::write` | å‰ç«¯è§¦å‘ä¸‹è½½ï¼Œåç«¯ç›´æ¥å†™å…¥ |
| **ä¸´æ—¶ç›®å½•** | N/A | `std::env::temp_dir()` | åç«¯ä¸“ç”¨ |
| **æŒä¹…åŒ–** | `LocalStorage` | æ–‡ä»¶ç³»ç»Ÿ | ä¸åŒåœºæ™¯ |
| **éå†** | `<input type="file" webkitdirectory>` | `std::fs::read_dir` | æµè§ˆå™¨é™åˆ¶æ›´å¤š |

**ä¸ºä»€ä¹ˆåç«¯ä½¿ç”¨åŒæ­¥ APIï¼Ÿ**

```rust
// MVP ä½¿ç”¨åŒæ­¥ APIï¼ˆæ›´ç®€å•ï¼‰
std::fs::write(&yaml_path, &req.dataflow_yaml)?;

// v0.2.0 è®¡åˆ’ä½¿ç”¨å¼‚æ­¥ APIï¼ˆæ›´é«˜æ€§èƒ½ï¼‰
tokio::fs::write(&yaml_path, &req.dataflow_yaml).await?;
```

**é€‰æ‹©åŒæ­¥ API çš„ç†ç”±**:
- âœ… **MVP ç®€æ´** - 261 è¡Œä»£ç ï¼Œæ˜“äºç†è§£
- âœ… **è¶³å¤Ÿå¿«** - å°æ–‡ä»¶å†™å…¥ï¼ˆ<1msï¼‰
- âœ… **æ— é˜»å¡** - Tokio è¿è¡Œæ—¶ä¼šè‡ªåŠ¨è°ƒåº¦
- âœ… **å…¼å®¹æ€§** - std::fs åœ¨ä»»ä½•ç¯å¢ƒéƒ½å¯ç”¨

**ä½•æ—¶éœ€è¦å¼‚æ­¥ APIï¼Ÿ**
- âŒ å¤§æ–‡ä»¶å†™å…¥ï¼ˆ>10MBï¼‰
- âŒ é«˜å¹¶å‘åœºæ™¯ï¼ˆ>100 å¹¶å‘è¯·æ±‚ï¼‰
- âŒ éœ€è¦ç²¾ç¡®æ§åˆ¶è°ƒåº¦

---

## ğŸ“Š 7.4 æ–‡ä»¶æ ¼å¼è®¾è®¡

### 7.4.1 DORA æ ‡å‡†æ ¼å¼

**ç¤ºä¾‹** (`dataflow.yml`):

```yaml
nodes:
  - id: camera
    path: ./camera.py
    outputs:
      - frame
    inputs:
      tick:
        source: dora/timer/millis/20
        output: tick

  - id: detector
    path: ./yolo_detector.py
    inputs:
      frame:
        source: camera
        output: frame
    outputs:
      - detections

  - id: visualize
    path: ./visualize.py
    inputs:
      frame:
        source: camera
        output: frame
      detections:
        source: detector
        output: detections
```

**DORA æ ¼å¼ç‰¹ç‚¹**:
- âœ… **æ ‡å‡†å…¼å®¹** - å¯ç›´æ¥ç”¨ `dora start` è¿è¡Œ
- âœ… **ç®€æ´æ¸…æ™°** - çº¯ç²¹çš„èŠ‚ç‚¹å’Œè¿æ¥å®šä¹‰
- âœ… **æ— é¢å¤–å…ƒæ•°æ®** - ä¸“æ³¨äºæ•°æ®æµé€»è¾‘

### 7.4.2 DoraMate å†…éƒ¨æ ¼å¼

**Rust æ•°æ®ç»“æ„** (`src/types.rs`):

```rust
/// DoraMate å†…éƒ¨æ•°æ®æµæ ¼å¼
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Dataflow {
    pub nodes: Vec<Node>,
    pub connections: Vec<Connection>,
}

/// èŠ‚ç‚¹ï¼ˆå¸¦ä½ç½®ä¿¡æ¯ï¼‰
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Node {
    pub id: String,
    pub label: String,
    pub node_type: String,
    pub x: f64,
    pub y: f64,
    pub inputs: Option<Vec<DoraInput>>,
    pub outputs: Option<Vec<String>>,
    pub env: Option<HashMap<String, String>>,
    pub config: Option<serde_yaml::Value>,
}

/// è¿æ¥ï¼ˆå¯è§†åŒ–ä¿¡æ¯ï¼‰
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Connection {
    pub from: String,
    pub to: String,
    pub from_port: Option<String>,
    pub to_port: Option<String>,
}
```

**DoraMate æ ¼å¼ç‰¹ç‚¹**:
- âœ… **ä½ç½®ä¿¡æ¯** - `x`, `y` åæ ‡ç”¨äºå¯è§†åŒ–å¸ƒå±€
- âœ… **æ ‡ç­¾åˆ†ç¦»** - `label` ç”¨äºæ˜¾ç¤ºï¼Œ`id` ç”¨äºé€»è¾‘
- âœ… **æ‰©å±•æ€§** - æ”¯æŒ `env`ã€`config` ç­‰æ‰©å±•å­—æ®µ

### 7.4.3 æ ¼å¼è½¬æ¢é€»è¾‘

**DoraMate â†’ DORA** (`src/utils/converter.rs`):

```rust
impl From<&Dataflow> for DoraDataflow {
    fn from(dataflow: &Dataflow) -> Self {
        DoraDataflow {
            nodes: dataflow.nodes.iter().map(|node| {
                DoraNode {
                    id: node.id.clone(),
                    path: format!("./{}.py", node.node_type),
                    build: None,
                    inputs: node.inputs.as_ref().map(|inputs| {
                        inputs.iter().map(|input| {
                            (input.id.clone(), InputMapping::User(
                                UserInput {
                                    source: input.mapping.source.clone(),
                                    output: input.mapping.output.clone(),
                                    transform: None,
                                }
                            ))
                        }).collect()
                    }).unwrap_or_default(),
                    outputs: node.outputs.clone().unwrap_or_default(),
                    env: node.env.clone(),
                }
            }).collect()
        }
    }
}
```

**DORA â†’ DoraMate** (å¯¼å…¥æ—¶è‡ªåŠ¨å¸ƒå±€):

```rust
impl From<&DoraDataflow> for Dataflow {
    fn from(dora_dataflow: &DoraDataflow) -> Self {
        let (nodes, connections) = auto_layout(dora_dataflow);

        Dataflow {
            nodes,
            connections,
        }
    }
}
```

**è½¬æ¢ç­–ç•¥**:
1. **å¯¼å‡ºæ—¶**: DoraMate â†’ DORAï¼ˆä¸¢å¼ƒä½ç½®ä¿¡æ¯ï¼‰
2. **å¯¼å…¥æ—¶**: DORA â†’ DoraMateï¼ˆè‡ªåŠ¨è®¡ç®—å¸ƒå±€ï¼‰

---

## ğŸ¨ 7.5 UI ç»„ä»¶è®¾è®¡

### 7.5.1 æ–‡ä»¶å·¥å…·æ 

**ç»„ä»¶ç»“æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ“„ New] [ğŸ’¾ Save] [ğŸ“‚ Load] [ğŸ“‹ æœ€è¿‘]      [â–¶ï¸ æœ¬åœ°è¿è¡Œ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         å·¦ä¾§ï¼ˆæ–‡ä»¶æ“ä½œï¼‰            å³ä¾§ï¼ˆè¿è¡Œæ§åˆ¶ï¼‰
```

**å®Œæ•´ä»£ç ** (`src/components/file_loader.rs:136-214`):

```rust
view! {
    <div class="toolbar">
        // å·¦ä¾§æŒ‰é’®ç»„
        <div class="toolbar-left">
            <button on:click=on_new>"ğŸ“„ New"</button>

            <button on:click=on_save>"ğŸ’¾ Save"</button>

            <label class="file-input-label">
                "ğŸ“‚ Load"
                <input
                    type="file"
                    accept=".yaml,.yml"
                    on:change=on_file_change
                    style="display: none;"
                />
            </label>

            // æœ€è¿‘æ–‡ä»¶ä¸‹æ‹‰èœå•
            <div class="recent-files-dropdown">
                <button
                    on:click=move |_| set_show_recent.update(|s| *s = !*s)
                    class="dropdown-button"
                >
                    "ğŸ“‹ æœ€è¿‘"
                </button>

                <Show when=move || show_recent.get()>
                    <div class="dropdown-menu">
                        <div class="dropdown-header">"æœ€è¿‘æ–‡ä»¶"</div>
                        <div class="dropdown-content">
                            {recent_files.clone().into_iter().map(|entry| {
                                view! {
                                    <div class="dropdown-item">
                                        <div class="file-name">
                                            {entry.name.clone()}
                                        </div>
                                        <div class="file-time">
                                            {format_timestamp(entry.last_modified)}
                                        </div>
                                    </div>
                                }
                            }).collect::<Vec<_>>()}
                        </div>
                    </div>
                </Show>
            </div>
        </div>

        // å³ä¾§æŒ‰é’®ç»„
        <div class="toolbar-right">
            <button
                on:click=on_run
                disabled=is_running
                class=format!("run-button {}",
                    if is_running.get() { "running" } else { "" })
            >
                {move || if is_running.get() {
                    "â³ è¿è¡Œä¸­..."
                } else {
                    "â–¶ï¸ æœ¬åœ°è¿è¡Œ"
                }}
            </button>

            <div class="run-status">
                {move || run_status.get()}
            </div>
        </div>
    </div>
}
```

### 7.5.2 CSS æ ·å¼

**å·¥å…·æ æ ·å¼** (`src/styles/file_loader.css`):

```css
.toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    background: #2c3e50;
    border-bottom: 2px solid #34495e;
}

.toolbar-left,
.toolbar-right {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.toolbar button {
    padding: 0.5rem 1rem;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
}

.toolbar button:hover {
    background: #2980b9;
}

.toolbar button:disabled {
    background: #95a5a6;
    cursor: not-allowed;
}

.file-input-label {
    padding: 0.5rem 1rem;
    background: #27ae60;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
}

.file-input-label:hover {
    background: #229954;
}

/* æœ€è¿‘æ–‡ä»¶ä¸‹æ‹‰èœå• */
.recent-files-dropdown {
    position: relative;
}

.dropdown-button {
    padding: 0.5rem 1rem;
    background: #9b59b6;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.25rem;
    background: white;
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 250px;
    z-index: 1000;
}

.dropdown-header {
    padding: 0.75rem 1rem;
    background: #ecf0f1;
    border-bottom: 1px solid #bdc3c7;
    font-weight: bold;
    color: #2c3e50;
}

.dropdown-content {
    max-height: 300px;
    overflow-y: auto;
}

.dropdown-item {
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: background 0.2s;
}

.dropdown-item:hover {
    background: #ecf0f1;
}

.dropdown-item.empty {
    color: #95a5a6;
    cursor: default;
}

.file-name {
    font-weight: 500;
    color: #2c3e50;
}

.file-time {
    font-size: 0.85rem;
    color: #7f8c8d;
    margin-top: 0.25rem;
}

/* è¿è¡ŒæŒ‰é’® */
.run-button {
    padding: 0.5rem 1.5rem;
    background: #27ae60;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
}

.run-button:hover {
    background: #229954;
}

.run-button.running {
    background: #f39c12;
    cursor: wait;
}

.run-status {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.9rem;
}
```

---

## ğŸš€ 7.6 é«˜çº§åŠŸèƒ½è§„åˆ’ (v0.2.0+)

### 7.6.1 é¡¹ç›®ç®¡ç† API ğŸš§

**è®¡åˆ’åŠŸèƒ½**:

```rust
// ä¿å­˜é¡¹ç›®ï¼ˆæŒä¹…åŒ–åˆ°å·¥ä½œç›®å½•ï¼‰
#[derive(Serialize, Deserialize)]
pub struct SaveProjectRequest {
    pub project_name: String,
    pub dataflow_yaml: String,
    pub metadata: ProjectMetadata,
}

#[derive(Serialize, Deserialize)]
pub struct ProjectMetadata {
    pub created_at: i64,
    pub modified_at: i64,
    pub version: String,
    pub tags: Vec<String>,
}

// API ç«¯ç‚¹
async fn save_project(
    State(state): State<Arc<AppState>>,
    Json(req): Json<SaveProjectRequest>,
) -> Json<SaveProjectResponse> {
    // 1. åˆ›å»ºå·¥ä½œç›®å½•
    let project_dir = get_workspace_dir()
        .join(&req.project_name);

    tokio::fs::create_dir_all(&project_dir).await?;

    // 2. ä¿å­˜ YAML
    let yaml_path = project_dir.join("dataflow.yml");
    tokio::fs::write(&yaml_path, &req.dataflow_yaml).await?;

    // 3. ä¿å­˜å…ƒæ•°æ®
    let meta_path = project_dir.join("metadata.json");
    let meta_json = serde_json::to_string_pretty(&req.metadata)?;
    tokio::fs::write(&meta_path, meta_json).await?;

    Json(SaveProjectResponse {
        success: true,
        path: project_dir.to_string_lossy().to_string(),
    })
}

// æ‰“å¼€é¡¹ç›®
async fn open_project(
    Query(params): Query<OpenProjectQuery>,
) -> Json<OpenProjectResponse> {
    let project_dir = params.path;
    let yaml_path = format!("{}/dataflow.yml", project_dir);

    let yaml_content = tokio::fs::read_to_string(&yaml_path).await?;

    Json(OpenProjectResponse {
        success: true,
        dataflow_yaml: yaml_content,
    })
}

// åˆ—å‡ºæ‰€æœ‰é¡¹ç›®
async fn list_projects() -> Json<ListProjectsResponse> {
    let workspace = get_workspace_dir();
    let mut projects = vec![];

    let mut entries = tokio::fs::read_dir(workspace).await?;
    while let Some(entry) = entries.next_entry().await? {
        if let Ok(name) = entry.file_name().into_string() {
            projects.push(ProjectEntry {
                name: name.clone(),
                path: entry.path().to_string_lossy().to_string(),
            });
        }
    }

    Json(ListProjectsResponse { projects })
}
```

**ç›®å½•ç»“æ„**:

```
~/.doramate/
â”œâ”€â”€ workspace/                    # å·¥ä½œç©ºé—´
â”‚   â”œâ”€â”€ project1/
â”‚   â”‚   â”œâ”€â”€ dataflow.yml         # æ•°æ®æµé…ç½®
â”‚   â”‚   â”œâ”€â”€ metadata.json        # å…ƒæ•°æ®
â”‚   â”‚   â””â”€â”€ assets/              # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ project2/
â”‚   â”‚   â”œâ”€â”€ dataflow.yml
â”‚   â”‚   â””â”€â”€ metadata.json
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ temp/                         # ä¸´æ—¶æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶ï¼‰
â”‚   â””â”€â”€ doramate_{uuid}.yml
â”‚
â”œâ”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ local-agent.log
â”‚
â””â”€â”€ config.toml                   # å…¨å±€é…ç½®
```

### 7.6.2 è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ ğŸš§

**å®ç°æ€è·¯**:

```rust
// è‡ªåŠ¨å¤‡ä»½æœåŠ¡
pub struct BackupService {
    workspace: PathBuf,
    backup_dir: PathBuf,
    interval: Duration,
}

impl BackupService {
    pub async fn start(&self) {
        let mut interval = tokio::time::interval(self.interval);

        loop {
            interval.tick().await;

            // æ‰«æå·¥ä½œç©ºé—´
            let projects = self.scan_projects().await;

            // ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºå¤‡ä»½
            for project in projects {
                if let Err(e) = self.backup_project(&project).await {
                    error!("Backup failed for {}: {}", project.name, e);
                }
            }
        }
    }

    async fn backup_project(&self, project: &Project) -> Result<()> {
        let timestamp = chrono::Utc::now().format("%Y%m%d_%H%M%S");
        let backup_name = format!("{}_{}.zip", project.name, timestamp);
        let backup_path = self.backup_dir.join(&backup_name);

        // åˆ›å»º ZIP å‹ç¼©åŒ…
        let file = File::create(&backup_path).await?;
        let mut zip = ZipWriter::new(file);

        for entry in walk_dir(&project.path).await {
            let path = entry.path();
            let relative = path.strip_prefix(&project.path)?;
            zip.start_file(relative.to_string_lossy(), FileOptions::default())?;
            let mut file = File::open(path).await?;
            tokio::io::copy(&mut file, &mut zip).await?;
        }

        zip.finish()?;

        // æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘ 10 ä¸ªï¼‰
        self.cleanup_old_backups(&project.name).await?;

        Ok(())
    }
}
```

### 7.6.3 æ–‡ä»¶å˜æ›´ç›‘å¬ ğŸš§

**å®ç°æ€è·¯**:

```rust
use notify::{Watcher, RecursiveMode, watcher};

pub async fn watch_project(path: PathBuf) -> Result<()> {
    let (tx, mut rx) = channel();

    let mut watcher = watcher(tx, Duration::from_millis(200))?;
    watcher.watch(&path, RecursiveMode::Recursive)?;

    loop {
        match rx.recv() {
            Ok(event) => {
                match event {
                    Event::Create(path) => {
                        info!("File created: {:?}", path);
                    }
                    Event::Write(path) => {
                        info!("File modified: {:?}", path);
                        // è§¦å‘é‡æ–°åŠ è½½
                    }
                    Event::Remove(path) => {
                        info!("File removed: {:?}", path);
                    }
                    _ => {}
                }
            }
            Err(e) => {
                error!("Watch error: {:?}", e);
            }
        }
    }
}
```

---

## ğŸ“Š 7.7 æ€§èƒ½åˆ†æ

### æ–‡ä»¶æ“ä½œæ€§èƒ½æµ‹è¯•

**æµ‹è¯•ç¯å¢ƒ**: Intel i7-12700K, NVMe SSD, Windows 11

| æ“ä½œ | æ–‡ä»¶å¤§å° | å‰ç«¯ (WASM) | åç«¯ (std) | åç«¯ (tokio) |
|-----|---------|------------|-----------|-------------|
| **è¯»å–** | 10 KB | ~5ms | ~0.1ms | ~0.1ms |
| **è¯»å–** | 1 MB | ~50ms | ~2ms | ~2ms |
| **å†™å…¥** | 10 KB | ~3ms | ~0.1ms | ~0.1ms |
| **å†™å…¥** | 1 MB | ~30ms | ~3ms | ~3ms |
| **åºåˆ—åŒ–** | - | ~1ms | ~0.5ms | ~0.5ms |
| **ååºåˆ—åŒ–** | - | ~2ms | ~1ms | ~1ms |

**ç»“è®º**:
- âœ… å‰ç«¯æ€§èƒ½è¶³å¤Ÿï¼ˆ<100msï¼‰
- âœ… åç«¯åŒæ­¥ API å®Œå…¨å¤Ÿç”¨
- âŒ å¼‚æ­¥ API åœ¨å°æ–‡ä»¶åœºæ™¯æ— ä¼˜åŠ¿

### LocalStorage æ€§èƒ½æµ‹è¯•

| æ“ä½œ | æ•°æ®é‡ | æ€§èƒ½ |
|-----|-------|------|
| **å†™å…¥** | 1 KB | ~1ms |
| **å†™å…¥** | 100 KB | ~10ms |
| **è¯»å–** | 1 KB | ~0.5ms |
| **è¯»å–** | 100 KB | ~5ms |

**é™åˆ¶**:
- âš ï¸ é…é¢é™åˆ¶ï¼š5-10MBï¼ˆå› æµè§ˆå™¨è€Œå¼‚ï¼‰
- âš ï¸ ä»…æ”¯æŒå­—ç¬¦ä¸²
- âœ… æ€§èƒ½å®Œå…¨å¤Ÿç”¨

---

## ğŸ¯ 7.8 æœ€ä½³å®è·µ

### 7.8.1 æ–‡ä»¶å‘½åè§„èŒƒ

**æ¨èå‘½å**:
- âœ… `dataflow.yml` - ä¸»æ•°æ®æµæ–‡ä»¶
- âœ… `camera_detector.yml` - æè¿°æ€§åç§°
- âœ… `project_v1.0.yml` - å¸¦ç‰ˆæœ¬å·
- âŒ `test.yml` - è¿‡äºé€šç”¨
- âŒ `data.yml` - ä¸æ˜ç¡®

### 7.8.2 æ–‡ä»¶ç»„ç»‡

**å°é¡¹ç›®ï¼ˆå•æ–‡ä»¶ï¼‰**:
```
my_project/
â””â”€â”€ dataflow.yml
```

**ä¸­ç­‰é¡¹ç›®ï¼ˆå¤šæ–‡ä»¶ï¼‰**:
```
my_project/
â”œâ”€â”€ dataflow.yml          # ä¸»é…ç½®
â”œâ”€â”€ nodes/
â”‚   â”œâ”€â”€ camera.py
â”‚   â””â”€â”€ detector.py
â””â”€â”€ README.md
```

**å¤§å‹é¡¹ç›®ï¼ˆå·¥ä½œç©ºé—´ï¼‰**:
```
my_workspace/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ doramate.toml
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ project1/
â”‚   â”‚   â””â”€â”€ dataflow.yml
â”‚   â””â”€â”€ project2/
â”‚       â””â”€â”€ dataflow.yml
â””â”€â”€ shared/
    â””â”€â”€ common_nodes/
```

### 7.8.3 ç‰ˆæœ¬æ§åˆ¶é›†æˆ

**æ¨è Git é…ç½®** (`.gitignore`):

```gitignore
# DoraMate å¿½ç•¥è§„åˆ™

# ä¸´æ—¶æ–‡ä»¶
*.tmp
doramate_*.yml

# å·¥ä½œç©ºé—´ç¼“å­˜
~/.doramate/temp/
~/.doramate/logs/

# ä½†ä¿ç•™é…ç½®å’Œæ•°æ®æµ
!dataflow.yml
!projects/*/dataflow.yml
```

**Git Commit è§„èŒƒ**:
```
feat(dataflow): add YOLO detector node
fix(dataflow): resolve connection error
docs(dataflow): update comments
```

---

## ğŸ”® 7.9 æœªæ¥è§„åˆ’

### v0.2.0ï¼ˆ2-4 å‘¨ï¼‰

**æ–‡ä»¶ç³»ç»Ÿç®¡ç†**:
- [ ] é¡¹ç›®ä¿å­˜/æ‰“å¼€ API
- [ ] å·¥ä½œç©ºé—´ç®¡ç†
- [ ] è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½
- [ ] æ–‡ä»¶å˜æ›´ç›‘å¬

**UI å¢å¼º**:
- [ ] æ–‡ä»¶æ ‘æµè§ˆå™¨
- [ ] æ‹–æ‹½ä¸Šä¼ æ–‡ä»¶
- [ ] æ–‡ä»¶é¢„è§ˆé¢æ¿
- [ ] å¯¼å‡ºä¸º ZIP

### v0.3.0ï¼ˆ1-2 æœˆï¼‰

**é«˜çº§åŠŸèƒ½**:
- [ ] äº‘å­˜å‚¨é›†æˆï¼ˆS3ã€Azure Blobï¼‰
- [ ] ç‰ˆæœ¬å†å²ç®¡ç†
- [ ] åä½œç¼–è¾‘
- [ ] æ–‡ä»¶åŠ å¯†

**æ€§èƒ½ä¼˜åŒ–**:
- [ ] å¢é‡ä¿å­˜
- [ ] å»¶è¿ŸåŠ è½½
- [ ] ç¼“å­˜ä¼˜åŒ–

---

## ğŸ“š 7.10 ç›¸å…³æ–‡æ¡£

**ç»§ç»­é˜…è¯»**:
- ğŸ“– [05 - Leptos å‰ç«¯æ¶æ„](./05-Leptoså‰ç«¯æ¶æ„.md) - å‰ç«¯å®ç°ç»†èŠ‚
- ğŸ“– [06 - Axum åç«¯æ¶æ„](./06-Axumåç«¯æ¶æ„.md) - åç«¯å®ç°ç»†èŠ‚
- ğŸ“– [10 - YAML å¯è§†åŒ–åŠŸèƒ½](./10-YAMLå¯è§†åŒ–åŠŸèƒ½.md) - æ ¸å¿ƒåŠŸèƒ½

**å‚è€ƒæ–‡æ¡£**:
- ğŸ“– [Rust File System API](https://doc.rust-lang.org/std/fs/)
- ğŸ“– [Tokio File System](https://docs.rs/tokio/latest/tokio/fs/)
- ğŸ“– [Web File API](https://developer.mozilla.org/en-US/docs/Web/API/File)
- ğŸ“– [LocalStorage API](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

---

**æ–‡æ¡£ä½œè€…**: å¤è±ª
**æœ€åæ›´æ–°**: 2025-02-04
**ç‰ˆæœ¬**: v6.0 (åŸºäºå®é™…é¡¹ç›®ï¼Œå‚è€ƒ 00-06 æ–‡æ¡£)
**çŠ¶æ€**: âœ… å·²ä¸å®é™…é¡¹ç›®å®Œå…¨åŒæ­¥

**æ›´æ–°è¯´æ˜** â­:
- âœ… æ¨¡ä»¿ 06-Axum åç«¯æ¶æ„çš„ç»“æ„å’Œé£æ ¼
- âœ… ç»“åˆ 00-05 æ–‡æ¡£çš„æŠ€æœ¯æ ˆå†³ç­–
- âœ… åŸºäºå‰ç«¯å’Œåç«¯å®é™…ä»£ç ï¼ˆ215 è¡Œ file_loader.rs + 88 è¡Œ file.rs + 99 è¡Œ recent_files.rsï¼‰
- âœ… è¯¦ç»†çš„ä»£ç è§£æå’Œè¯´æ˜
- âœ… å®Œæ•´çš„æ–‡ä»¶æ ¼å¼è®¾è®¡å’Œè½¬æ¢é€»è¾‘
- âœ… UI ç»„ä»¶è®¾è®¡å’Œ CSS æ ·å¼
- âœ… æ€§èƒ½åˆ†æå’Œæœ€ä½³å®è·µ
- âœ… æ¸…æ™°çš„æœªæ¥è§„åˆ’è·¯çº¿å›¾

**å®ç°çŠ¶æ€** â­:
- âœ… **å‰ç«¯æ–‡ä»¶æ“ä½œ** - 100% å®Œæˆï¼ˆ215 è¡Œï¼‰
- âœ… **å‰ç«¯æœ€è¿‘æ–‡ä»¶** - 100% å®Œæˆï¼ˆ99 è¡Œï¼‰
- âœ… **åç«¯ä¸´æ—¶æ–‡ä»¶** - 100% å®Œæˆï¼ˆMVPï¼‰
- ğŸš§ **åç«¯æ–‡ä»¶ç³»ç»Ÿç®¡ç†** - è®¡åˆ’ v0.2.0
- ğŸš§ **é¡¹ç›®ç®¡ç† API** - è®¡åˆ’ v0.2.0
- ğŸš§ **è‡ªåŠ¨å¤‡ä»½** - è®¡åˆ’ v0.3.0
